<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="google-site-verification" content="7tTF0t5uCMnyE6X31OIOQpcOf4QxWuODtyZLoVsKCEc" />
  <meta name="msvalidate.01" content="7FC9C7BCD4002EBD89AAC2EF63D7B353" />
  <link rel="icon" type="image/png" href="favicon48.png" sizes="48x48">
  <meta name='description' content='Example for devices with only 1MByte flash memory.'>
  <title>Minimal Sized Example</title>
  <link Content-Type="text/css" href="/docstyle.css" rel="stylesheet" />
  <script src="/pages.js"></script>
  <script src="/story.js" type="module"></script>
  <style>
  .gpio { 
    display:inline-block;
    padding: 0 4px;
    border-radius: 4px;
    }
  .gpio.yellow {background-color: #FF0;}
  .gpio.red {background-color: #F22; color:white}
  .gpio.black {background-color: #111; color:white}
  .gpio.blue {background-color: #22F; color:white}
  </style>
</head>

<body scroll="0" style="padding:0;">
  <div class="u-navbar" style="margin-bottom: 0;">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" id="menuButton" class="button" style="height:1.4rem">
      <path fill="white" d="M0 8h48v6H0zm0 13h48v6H0zm0 13h48v6H0z" />
    </svg>

    <a href="/index.htm" class="button">Home</a>
    <a href="/concepts/index.htm" class="button">Concepts</a>
    <a href="/elements/index.htm" class="button">Elements</a>
    <a href="/boards/index.htm" class="button">Boards</a>
    <a href="/recipes/index.htm" class="button">Recipes</a>
  </div>

  <nav class="inpage open"></nav>

  <main style="padding:1rem;max-width: 800px;">
    <h1>Minimal Sized Example</h1>

    
      
    <div class="plaincard"><p>The <strong>minimal example</strong>
runs on the ESP8266 boards that only have a small amount of Flash Memory (1 MByte) available for program and web UI storage
like the <a href="/boards/esp01.htm">ESP-01 board</a> and devices like <a href="/boards/sonoffbasic.htm">sonoff S20 switch</a> and <a href="/boards/bulb.htm">bulbs</a>.</p>
</div>
<p>The examples in the HomeDing library are used to compile a firmware that provides the base functionality
combined with a set of elements that can be used in the configuration of the device.</p>
<h2>Approach for development</h2>
<p>These devices are not really usable during development.</p>
<ul>
<li>Diagnostic Elements cannot be compiled into the sketch to reduce program size.</li>
<li>Log files cannot be stored on the device</li>
<li>The filesystem on the device is very limited.</li>
<li>The Serial communication often is unavailable in sealed devices.</li>
<li>A auto-reset feature is missing for flashing new firmware over USB.</li>
</ul>
<p>Thereforefore it is recommended:</p>
<ul>
<li>Use a board like a <a href="/boards/nodemcu.htm">NodeMCU</a> but keep an eye of memory consumption.</li>
<li>Use a <a href="/boards/esp01.htm">ESP-01 board</a> to verify the solution is working with the target sizing.</li>
<li>Uploading a new firware to the target device.</li>
</ul>
<h2>Reduced memory footprint</h2>
<p>Compared to the <a href="/examples/standard.htm">Standard example</a> some measures have been taken to reduce required program memory.</p>
<p>From the 1 MByte of memory only 128kByte of memory is used for the file system
leaving about 445 kByte for program space while still enabling OTA / network based updates.</p>
<p>When compiling the sketch to create a firmware only a small set of elements are included (see below). The web files are also minimized and reduced in functionality to allow a minimal UI implementation and logging is disabled to save memory in the filesystem.
Compared to the Standard example about 52 kByte less program space is required.
When disabling the debug port in the Board configuration another 1.5 kByte can be saved.</p>
<h2>Reducing the set of Elements</h2>
<p>The elements that are included in this example sketch are those that support sockets, switches and lights but no sensors and displays. The logical, time and remote elements are included as well to support integration.</p>
<p>As of this writing the elements included are:</p>
<p>ota, device, value, button, switch, and, reference, time, alarm, ntptime, timer, schedule, digitalin, digitalout, remote, dht, color, light, neo, bl0937, my9291, ssdp</p>
<p>You can control what elements are included in the firmware file by enabling or disabling the #define statements for registering the elements in the sketch file.</p>
<p>If you like to know what element are available in a device just ask for the URL http://&lt;devicename&gt;/$elements</p>
<h2>How to Configure and Upload</h2>
<p>There are 2 transfer jobs to upload the firmware and the files of the filesystem.</p>
<h3>1. Compile and upload the sketch</h3>
<p>The sketch from this example can be compiled without any dependencies to external libraries.
There are some options documented in the source code e.g. to enable WS2812 LED stripes (a.k.a. NeoPixels) that you may like to enable after installing the required libraries.</p>
<p>You can upload using a USB / Serial cable when flashing the first time or use the OTA feature after flashing any OTA enabled firmware.
The example includes the OTA upload feature to enable remote updates.</p>
<h3>2. Upload the web ui files</h3>
<p>See <a href="/steps/updateweb.htm">Step by Step uploading the files for the web UI</a>.</p>
<p>The files for such minimal devices are reduced and available in the <code>v03m</code> folder (not <code>v03</code>).
Please be sure to adjust the URL by appending #v03m like <a href="http://outdoor/$update.htm#v03m">http://outdoor/$update.htm#v03m</a>.
You may need to refresh the page until you see the text
<strong>loading from: <a href="https://homeding.github.io/v03m/">https://homeding.github.io/v03m/</a></strong>.</p>
<h2>Web UI</h2>
<p>The Web UI that comes with this example fits into 128 kByte and provides showing actual sensor and actor values implemented in the /ding.html file that is also available on the standard Web UI for the standard example.</p>
<ul>
<li>network configuration : /$setup</li>
<li>UI to upload: /$upload</li>
<li>minimal dashboard: /ding.htm</li>
<li>min editor: /microide.htm</li>
<li>no full icon set - only one device icon. /i/default.svg</li>
<li>favicons.</li>
</ul>
<h2>Modifications</h2>
<p>This example also acts as a starting point for other sensors that need no extensive ui capabilities or use the <a href="/dev/deepsleep.htm">deep sleep mode</a> and wake-up modus to save energy when powered by battery or solar.</p>
<p>Not included elements of the library can be added by defining the Element to be included in the sketch. There are some commented lines in the source code that show how this can be achieved.</p>
<p>When you implement your own elements you can just add them to the sketch folder.</p>
<!-- 
## OTA Update

* <https://github.com/arendst/Sonoff-Tasmota>
* <https://goblinsleg.wordpress.com/category/sonoff-tasmota/>
* <https://github.com/ct-Open-Source/tuya-convert/wiki/Compatible-devices>
* <https://www.heise.de/ct/artikel/Tuya-Convert-Escaping-the-IoT-Cloud-no-solder-need-4284830.html>
* <https://goblinsleg.wordpress.com/category/sonoff-tasmota/>
* <https://goblinsleg.wordpress.com/2017/12/28/diy-home-automation-with-openhab-2-part-3/>
 -->


    
  </main>

  <script>
    var mbObj = document.querySelector('#menuButton');
    var navObj = document.querySelector('nav');

    navObj.classList.toggle('open', (window.innerWidth > 880));

    mbObj.addEventListener('click', function (e) {
      navObj.classList.toggle('open');
    });

    lazyLoadHTM('nav', '/toc.htm');
  </script>
  
  </body>

</html>