
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SD MMC card Element</title>
    <script src="/pages.js"></script>
    <link content-type="text/css" href="/docstyle.css" rel="stylesheet"/>
    <script src="/story.js" type="module"></script>
    <link rel="icon" type="image/png" href="/favicon48.png" sizes="48x48">
    <meta name='description' content='Using SD MMC cards for storing local files on ESP32.'>
    <meta name="google-site-verification" content="7tTF0t5uCMnyE6X31OIOQpcOf4QxWuODtyZLoVsKCEc"/>
    <meta name="msvalidate.01" content="7FC9C7BCD4002EBD89AAC2EF63D7B353"/>
  </head>
  <body scroll="0" style="padding:0;">
    <div class="u-navbar" style="margin-bottom: 0;">
      <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 48 48" id="menuButton" class="button" style="height:1.4rem">
        <path fill="white" d="M0 8h48v6H0zm0 13h48v6H0zm0 13h48v6H0z"/>
      </svg>
      <a href="/index.htm" class="button">Home</a>
      <a href="/elements/index.htm" class="button">Elements</a>
      <a href="/boards/index.htm" class="button">Boards</a>
      <a href="/recipes/index.htm" class="button">Recipes</a>
    </div>
    <nav></nav>
    <main style="padding:1rem;max-width: 800px;">
      <h1>SD MMC card Element</h1>
      
        
          <div class="iconcard">
            <svg class="icon">
              <use href="/icons.svg#sdcard"></use>
            </svg>
          
            The SDMMCElement implements access to the file system on a SDMMC card on ESP32 processors and boards.

          </div>
        
        <p>There are 2 SD card supporting elements in the Homeding library, supporting the 2 different available wirings:</p>
<ul>
<li>SD cards using standard SPI data transfer is supported by the <a href="/elements/sd.htm">SD Element</a></li>
<li>SD card using the MMC support available on with ESP32 processors is supported by the <a href="/elements/sdmmc.htm">SD MMC Element</a></li>
</ul>
<p>Only one of these Elements can be activated at a time.</p>
<p>Both implementations enable using the SD card memory for storing files locally
e.g. for recording sensor data or serving additional files on the web frontend.</p>
<p>The SDMMC Element is available on ESP32 boards only and fast data transfer is supported by the hardware.
It provides a fast 4-bit bus implementation for SD cards.</p>
<p>See <a href="/elements/sd.htm">SD Element</a> that is available on ESP32 and ESP8266 boards offers
a slower alternative using SPI access to SD Cards.</p>
<pre class="language-txt"><code class="language-txt">  From Arduino SDMMC examples:

 * pin 1 - D2                |  Micro SD card     |
 * pin 2 - D3                |                   /
 * pin 3 - CMD               |                  |__
 * pin 4 - VDD (3.3V)        |                    |
 * pin 5 - CLK               | 8 7 6 5 4 3 2 1   /
 * pin 6 - VSS (GND)         | ▄ ▄ ▄ ▄ ▄ ▄ ▄ ▄  /
 * pin 7 - D0                | ▀ ▀ █ ▀ █ ▀ ▀ ▀ |
 * pin 8 - D1                |_________________|
 *                             ║ ║ ║ ║ ║ ║ ║ ║
 *                     ╔═══════╝ ║ ║ ║ ║ ║ ║ ╚═════════╗
 *                     ║         ║ ║ ║ ║ ║ ╚══════╗    ║
 *                     ║   ╔═════╝ ║ ║ ║ ╚═════╗  ║    ║
 * Connections for     ║   ║   ╔═══╩═║═║═══╗   ║  ║    ║
 * full-sized          ║   ║   ║   ╔═╝ ║   ║   ║  ║    ║
 * SD card             ║   ║   ║   ║   ║   ║   ║  ║    ║
 * ESP32-S3 DevKit  | 21  47  GND  39 3V3 GND  40 41  42  |
 * ESP32-S3-USB-OTG | 38  37  GND  36 3V3 GND  35 34  33  |
 * ESP32            |  4   2  GND  14 3V3 GND  15 13  12  |
 * Pin name         | D1  D0  VSS CLK VDD VSS CMD D3  D2  |
 * SD pin number    |  8   7   6   5   4   3   2   1   9 /
 *                  |                                  █/
 *                  |__▍___▊___█___█___█___█___█___█___/
 * WARNING: ALL data pins must be pulled up to 3.3V with an external 10k Ohm resistor!
 * Note to ESP32 pin 2 (D0): Add a 1K Ohm pull-up resistor to 3.3V after flashing
 *
 * SD Card | ESP32
 *    D2       12
 *    D3       13
 *    CMD      15
 *    VSS      GND
 *    VDD      3.3V
 *    CLK      14
 *    VSS      GND
 *    D0       2  (add 1K pull up after flashing)
 *    D1       4
 *
 *    For more info see file README.md in this library or on URL:
 *    https://github.com/espressif/arduino-esp32/tree/master/libraries/SD_MMC</code></pre>
<h2>Element Configuration</h2>
<p>The following properties are available for configuration of the element:</p>
<blockquote>
<p><strong>mmcd0</strong> –  data line 0.</p>
<p><strong>mmcd1</strong> –  data line 1</p>
<p><strong>mmcd2</strong> – data line 2</p>
<p><strong>mmcd3</strong> – data line 3</p>
<p><strong>mmcclk</strong> – Clock</p>
<p><strong>mmccmd</strong> – Command</p>
<p>The SD_MMC pins can be freely defined on the ESP32-S3 processors.
On other ESP32 processors the pins are defined by the chip hardware and no pin configuration is required.</p>
</blockquote>
<p>From the base element implementation the following properties are available for configuration:</p>
<blockquote>
<p><strong>title</strong> – Caption text for the element. Used by the element specific cards on the dash boards.</p>
<p><strong>description</strong> – A line of text that gives a short description of the device used in the web UI.</p>
<p><strong>room</strong> – The location of the device.</p>
<p><strong>loglevel</strong> – This property holds the element specific log level. The default value is LOGGER_LEVEL_ERR == 1.</p>
<p><strong>startup</strong> – This property can be used to start the element using a different initialization phase.
Possible values are “sys”, “net”, “time”. See <a href="/dev/startup.htm">The Startup sequence</a>.</p>
</blockquote>
<h3>Configuration Example</h3>
<p>This example shows how to configure this element:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span> 
  <span class="token property">"sdmmc"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"0"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"mmcD0"</span><span class="token operator">:</span> <span class="token string">"14"</span><span class="token punctuation">,</span>
      <span class="token property">"mmcD1"</span><span class="token operator">:</span> <span class="token string">"17"</span><span class="token punctuation">,</span>
      <span class="token property">"mmcD2"</span><span class="token operator">:</span> <span class="token string">"21"</span><span class="token punctuation">,</span>
      <span class="token property">"mmcD3"</span><span class="token operator">:</span> <span class="token string">"18"</span><span class="token punctuation">,</span>
      <span class="token property">"mmcCLK"</span><span class="token operator">:</span> <span class="token string">"12"</span><span class="token punctuation">,</span>
      <span class="token property">"mmcCMD"</span><span class="token operator">:</span> <span class="token string">"16"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h2>File upload</h2>
<p>Files can be uploaded to the sd card using the integrated IDE.
For updates of multiple files an larger volume
the sd card can be removed and updated directly by mounting on a PC.</p>
<h2>HomeDing Filesystem Utility</h2>
<p>The mandatory flash file system LittleFS using flash memory
is used as the root file system to store at least the configuration files.</p>
<p>The files on a SD card are added (mounted) to this file system inside the /sd folder.</p>
<p>When implementing Elements that need files on the file system the HomeDingFS class provides
static functions for accessing files and directories by using the right filesystem for flash or sd.</p>

        
          <h2>Tags</h2>
          <div class="taglist">
            
              <a href="/tag/element.htm">Element</a>
            
              <a href="/tag/element.htm">Element</a>
            
          </div>
        
      </main>
      <script>
        const param = {
          MENU_MIN_WIDTH: 1030
        };
        var mbObj = document.querySelector('#menuButton');
        var navObj = document.querySelector('nav');
        if (window.innerWidth > param.MENU_MIN_WIDTH) { // menu is inside the page
          navObj.classList.add('open');
          navObj.classList.add('inpage');
        }
        mbObj.addEventListener('click', function (e) {
          navObj.classList.toggle('open');
        });
        lazyLoadHTM('nav', '/toc.htm');
      </script>

      <script type="module" async>
        import mermaid from "https://unpkg.com/mermaid@10/dist/mermaid.esm.min.mjs";
        document.addEventListener('DOMContentLoaded', mermaid.initialize({startOnLoad: true}));
      </script>

    </body>
  </body>
</html>