
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="7tTF0t5uCMnyE6X31OIOQpcOf4QxWuODtyZLoVsKCEc"/>
    <meta name="msvalidate.01" content="7FC9C7BCD4002EBD89AAC2EF63D7B353"/>
    <link rel="icon" type="image/png" href="favicon48.png" sizes="48x48">
    <title>Time Elements</title>
    <meta name='description' content='Examples and documentation for the HomeDing IoT Library'>
    <link content-type="text/css" href="/docstyle.css" rel="stylesheet"/>
    <script src="/pages.js"></script>
    <script src="/story.js" type="module"></script>
  </head>
  <body scroll="0" style="padding:0;">
    <div class="u-navbar" style="margin-bottom: 0;">
      <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 48 48" id="menuButton" class="button" style="height:1.4rem">
        <path fill="white" d="M0 8h48v6H0zm0 13h48v6H0zm0 13h48v6H0z"/>
      </svg>
      <a href="/index.htm" class="button">Home</a>
      <a href="/elements/index.htm" class="button">Elements</a>
      <a href="/boards/index.htm" class="button">Boards</a>
      <a href="/recipes/index.htm" class="button">Recipes</a>
    </div>
    <nav></nav>
    <main style="padding:1rem;max-width: 800px;">
      <h1>Time Elements</h1>
      
        <p>Several elements are related to the current local time. These are bundled together as the time related elements.</p>
<p>For using a real local time on a device the HomeDing library supports</p>
<ul>
<li>elements that retrieve the local time from the internet, using radio receiver or from a local RTC chip.</li>
<li>elements that create actions based on the local time like alarms and timers</li>
<li>elements that use the local time to add the current timestamp to sensor data</li>
</ul>
<p>The ESP boards to have a system timer that keeps and updates a local time with a accuracy that is acceptable for some hours. However this timer needs to be initialized every time the system reboots and must be adjusted every some hours to keep it accurate.</p>
<h2>accessing and adjusting the local time</h2>
<p>The <a href="/elements/ntptime.htm">NTPTime Element</a> retrieves the current time from a NTP server and can translate it into the local time by using to local timezone setting.
Devices that can reach a NTP internet service can use this option.</p>
<p>After a reboot the elements that require a accurate local time will not start working when the NTP time request fails.
As this can happen it is not an option for devices that must operate even when the internet is not available like heating systems.</p>
<p>The <a href="/elements/dstime.htm">DSTime Element</a> retrieves the current local time from a local attached RTC Chip like the DS3231.
After a reboot the time will be restored from the chip. This is a good option for devices that must operate even when the internet is not available like heating systems.</p>
<!-- The DCFTime Element will ... -->
<h2>Using time in element implementations</h2>
<p>Because timing is required by many Elements the time and real-time feature is directly supported by the board class.</p>
<p>The <a href="/elements/time.htm">Time Element</a> send actions with the actual local time as a value. This can be used e.g. to display the current time on a display.</p>
<p>The <a href="/elements/schedule.htm">Schedule Element</a> send on and off actions based on the actual local time. This can be used e.g. to switch a light.</p>
<p>The <a href="/elements/alarm.htm">Alarm Element</a> sends a single action when the configured alarm time passes.
This can be used e.g. to start a wakeup procedure.</p>
<p>The <a href="/elements/timer.htm">Timer Element</a> is not working based on a local time and creates timer (duration) based actions. This element can be used even when no current local time is known to the device.</p>
<p><strong>Board-&gt;getSeconds()</strong></p>
<p>The <code>getSeconds()</code> method in the <code>board</code> class returns the full seconds since starting the device.</p>
<p>Because most of the timings are based on seconds this method can be used as the timing reference for emitting events when real time is not required.</p>
<p>Using the getSeconds function is preferred over using (millis() / 1000).</p>
<p><strong>Board-&gt;getTimeOfDay()</strong></p>
<p>When a real time is available this method return the seconds since starting the day. It returns 0 when the real time is not available.</p>
<p>To use this functionality a <a href="/elements/ntptime.htm">NTPTime Element</a> or <a href="/elements/dstime.htm">DSTime Element</a> needs to be configured.</p>
<p><strong>Board-&gt;getTime()</strong></p>
<p>When a real time is available this method returns the milliseconds since 1.1.1970 a usual binary format for times in C++.</p>
<p>To use this functionality a <a href="/elements/ntptime.htm">NTPTime Element</a> or <a href="/elements/dstime.htm">DSTime Element</a> needs to be configured.</p>
<!-- To set the real time to an actual value this function must be called and the milliseconds since 1970 must be passed. The offset to the current millis is recorded order adjusted.
The board internally uses the millis function from the Arduino Library to calculate the current real-time.
Be aware that when using the deep sleep mode that the millis can â€¦ -->
<!-- Using actions dispatched over the network to exchange a current time has a latency that may be too much to be accurate for a specific use case. Local actions are better to be used for this so you may consider using a local Time Element on the devices that have real-time requirements.

Some interesting use cases are using the real time like clock displays and Things that need to know it is day or night or just log sensor data that must be analyzed later. -->
<h2>See also</h2>
<ul>
<li><a href="https://makezine.com/2019/01/18/getting-started-with-real-time-clocks/">https://makezine.com/2019/01/18/getting-started-with-real-time-clocks/</a></li>
</ul>

        
      </main>
      <script>
        const param = {
          MENU_MIN_WIDTH: 1030
        };
        var mbObj = document.querySelector('#menuButton');
        var navObj = document.querySelector('nav');
        if (window.innerWidth > param.MENU_MIN_WIDTH) { // menu is inside the page
          navObj.classList.add('open');
          navObj.classList.add('inpage');
        }
        mbObj.addEventListener('click', function (e) {
          navObj.classList.toggle('open');
        });
        lazyLoadHTM('nav', '/toc.htm');
      </script>
    </body>
  </body>
</html>