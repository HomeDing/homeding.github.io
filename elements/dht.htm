
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DHT Element</title>
  <script src="/pages.js"></script>
  <link content-type="text/css" href="/docstyle.css" rel="stylesheet"/>
  <script src="/story.js" type="module"></script>
  <link rel="icon" type="image/png" href="/favicon48.png" sizes="48x48">
  <meta name='description' content='Support of the DHT air temperature and humidity sensor chips.'>
  <meta name="google-site-verification" content="7tTF0t5uCMnyE6X31OIOQpcOf4QxWuODtyZLoVsKCEc"/>
  <meta name="msvalidate.01" content="7FC9C7BCD4002EBD89AAC2EF63D7B353"/>
</head>

<body class="sitelayout" style="--content-width:800px">
  <div class="navbar">
    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 48 48" id="menuButton" class="button" style="height:1.4rem">
      <path fill="white" d="M0 8h48v6H0zm0 13h48v6H0zm0 13h48v6H0z"/>
    </svg>
    <a href="/index.htm" class="button">Home</a>
    <a href="/elements/index.htm" class="button">Elements</a>
    <a href="/boards/index.htm" class="button">Boards</a>
    <a href="/recipes/index.htm" class="button">Recipes</a>
  </div>
  
  <nav class="menu"></nav>

  <main>
    <h1>DHT Element</h1>

    
      <div class="card-container horizontal text" style="--card-height:5rem;--card-image-size:5rem;">
        <div class="card">
          
            <svg>
              <use href="/icons.svg#dht"></use>
            </svg>
          
          <div class="body">
            <p>The DHT Element allows retrieving temperature and humidity values from the DHT11, DHT22 and AM2302 sensors and creates actions when new values are available.</p>

          </div>
        </div>
      </div>
    

    <p>The current values are also sent out to other elements using actions when they stay the same for some time to allow remote devices to resume to the current values after reboot or network outages.</p>
<p><img src="/elements/dht22pins.jpg" alt="DHT22 pins" title="w400">
<img src="/elements/dht22board.jpg" alt="DHT22 on Breadboard" title="w200"></p>
<h2>Web UI for the DHT Element</h2>
<p>There is a dedicated card for this element available that shows the actual temperature and humidity.</p>
<p><img src="/elements/dhtui.png" alt="DHT Sensor UI"></p>
<h2>Using the DHT Element</h2>
<p>The DHT Element is not part of the core set of elements because the low level communication to the chips the <code>DHTNEW</code> library is used and needs to be installed using the Arduino library manager.</p>
<p>Install the <code>DHTNEW</code> library by Rob Tillaart before including this element. When you install the HomeDing Library by using the Arduino library manager it can be installed as a dependency.</p>
<p>The <em><strong>HOMEDING_INCLUDE_DHT</strong></em> must be defined in the main sketch to compile and register the element.</p>
<pre class="language-cpp"><code class="language-cpp"><span class="token comment">// Use some more Elements that need additional libraries</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">HOMEDING_INCLUDE_DHT</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;HomeDing.h></span></span></code></pre>
<!-- The DHT Sensor example shows how to configure a sensor device that reads the sensor values from a DHT and shows them in the Web UI. -->
<p>The following sensor chips from the DHT family are supported by the DHTesp library:</p>
<ul>
<li>DHT11</li>
<li>DHT22 (identical to AM2302)</li>
<li>AM2302</li>
<li>AM2320 (in dht mode)</li>
<li>RHT03</li>
</ul>
<p>more details can be found at <a href="https://github.com/beegee-tokyo/DHTesp">https://github.com/beegee-tokyo/DHTesp</a></p>
<h2>Connecting a DHT Sensor</h2>
<p>The sample configuration coming with the DHT22 recipes is configured to use a DHT22 type of sensor with the data line attached to a GPIO like (D5).</p>
<p><img src="/elements/dhtwires.png" alt="DHT Wiring"></p>
<p>The configuration of the used pin can be changed easily by modifying the element properties in the config.json file.</p>
<h2>Connecting a AM2320 Sensor</h2>
<p>The AM2320 sensor is a drop-in replacement for the DHT22 with almost the same wiring and smaller in size.</p>
<p>In addition to the DHT22 wiring the not connected (nc) pin needs also to be connected to GND to use the compatible data protocol.</p>
<p>The AM2320 sensor also offers to communicate using the <a href="/dev/i2c.htm">I2C protocol</a>. This is supported using the <a href="/elements/am2320.htm">AM2320 Element</a> by the HomeDing library.</p>
<h3>About the pull-up resistor</h3>
<p>There is a 10k resistor required between pin 1 and 2 to pull the signal up. Both sides, the sensor and teh processor only hav to pull the signal to LOW
when the protocol requires it; the resistors sets the bus level to HIGH in the case none of participants pulls the level to LOW.</p>
<p>Adding a resistor can be done by software using the ESP8266 internal pullup feature on an input pin by using the pin configuration. But because we switch from input to output frequently is is good to have a constant solution using a external resistor.</p>
<p>Some sensors are known to have a pullup already inside, but it doesn’t hurt to add another one!
In the end a physical resistor is not too expensive to be added, it might work without.</p>
<p>The datasheet also suggests using a 100nf capacitor between pin 1 (VCC) and pin 4 (GND) to make power more stable that is also appropriate when a long cable is used.</p>
<p>There is an option to switch the sensor on and off by using another GPIO pin. See below.</p>
<h2>Element Configuration</h2>
<p><object data="/element.svg?dht" type="image/svg+xml"></object></p>
<p>The following properties are available for configuration of the element:</p>
<blockquote>
<p><strong>pin</strong>* – Specifies the hardware number of the pin that is used to connect the DHT sensor for data.</p>
<p><strong>type</strong> – The type of the sensor. Values are: “DHT11”, “DHT22” and “AUTO”</p>
<p><strong>onTemperature</strong> – These actions are emitted by the element when the temperature gets a new value. The action will not be sent when reading the sensor values that &gt; stay the same.</p>
<p><strong>onHumidity</strong> – These actions are emitted by the element when the humidity gets a new value. The action will not be sent when reading ne sensor values that stay &gt; the same.</p>
<p><strong>powerpin</strong> – This output pin can be specified to switch the sensor on and off.
This output pin can be specified and can be used to re-start the DHT sensor by using the circuit described below.</p>
<p><strong>powerinvert</strong> -This property controls the physical level of the powerpin. When set to true the sensor is enabled by creating a physical LOW level.</p>
</blockquote>
<p>From the base <a href="/elements/sensors.htm">Sensor Element</a> implementation the following properties are available for configuration:</p>
<blockquote>
<p><strong>readTime</strong> – Time between 2 probes being fetched from the sensor. Default value is 1m.</p>
<p><strong>resendTime</strong> – The current values of the probe are resent after this specified time even when not changing.</p>
<p><strong>warmupTime</strong> – This time is waited after powering the sensor on the first start or after a reset before the first data is fetched.
The default time is set to 3 seconds.</p>
<p><strong>restart</strong> – This property can be set to true to enable an automated restart when the sensor was not responding data.</p>
</blockquote>
<p>From the base element implementation the following properties are available for configuration:</p>
<blockquote>
<p><strong>title</strong> – Caption text for the element. Used by the element specific cards on the dash boards.</p>
<p><strong>description</strong> – A line of text that gives a short description of the device used in the web UI.</p>
<p><strong>room</strong> – The location of the device.</p>
<p><strong>loglevel</strong> – This property holds the element specific log level. The default value is LOGGER_LEVEL_ERR == 1.</p>
<p><strong>startup</strong> – This property can be used to start the element using a different initialization phase.
Possible values are “sys”, “net”, “time”. See <a href="/dev/startup.htm">The Startup sequence</a>.</p>
</blockquote>
<p>* This parameter must be specified.</p>
<h3>Configuration Example</h3>
<p>This example shows how to configure this element:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dht"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"on"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"pin"</span><span class="token operator">:</span> <span class="token string">"D5"</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"DHT22"</span><span class="token punctuation">,</span>
      <span class="token property">"readtime"</span><span class="token operator">:</span> <span class="token string">"30s"</span><span class="token punctuation">,</span>
      <span class="token property">"resendtime"</span><span class="token operator">:</span> <span class="token string">"2m"</span><span class="token punctuation">,</span>
      <span class="token property">"onTemperature"</span><span class="token operator">:</span> <span class="token string">"device/0?log=temp: $v\u00dfC"</span><span class="token punctuation">,</span>
      <span class="token property">"onHumidity"</span><span class="token operator">:</span> <span class="token string">"device/0?log=hum: $v%"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h2>Element State</h2>
<p>The following properties are available with the current values at runtime</p>
<blockquote>
<p><strong>active</strong> – Is set to true when the element is active.</p>
<p><strong>temperature</strong> – The last read temperature value from the sensor.</p>
<p><strong>humidity</strong> – The last read humidity value from the sensor.</p>
</blockquote>
<h3>Example State</h3>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dht/on"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"active"</span><span class="token operator">:</span><span class="token string">"true"</span><span class="token punctuation">,</span>
    <span class="token property">"temperature"</span><span class="token operator">:</span><span class="token string">"27.30"</span><span class="token punctuation">,</span>
    <span class="token property">"humidity"</span><span class="token operator">:</span><span class="token string">"50.50"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h2>DHT reset and power control</h2>
<p>I had the problem with unresponsive sensors that is also discussed on the internet.</p>
<p>This occurs after some successful operation time and seems to happen more often when the sensor is using a 3.3 V power supply instead of 5V.</p>
<p>I recommend to power the sensor with 5 V when ever this is possible but here is the approach to reset the sensor by powering off for some time.</p>
<p>This is done by the following circuit that switches the GND level power to the sensor:</p>
<p><img src="/elements/dhtpower.png" alt="DHT Power switch"></p>
<p>The voltage drop on the 2N7000 MOSFET is very small so the sensor is still working.</p>
<p>The DHT Element recognizes a unresponsive sensor that war working before and will turn off operation using the <code>term()</code> function.</p>
<p>If this happens during a sensor data read and the <code>restart</code> property is set to true the sensor is switched on again and after the warmup time has passed another data read try is started.</p>
<p>If failing repeats the sensor is switched off completely but can be restarted by another <code>start</code> action.</p>
<h2>Implementation Details</h2>
<p>As the sensor has a builtin sensor period of 0.5 to 2 seconds depending on the model
it doesn’t make sense to read the values from the sensor more frequently.</p>
<h2>See Also</h2>
<ul>
<li>
<p>DataSheet:
<a href="https://www.sparkfun.com/datasheets/Sensors/Temperature/DHT22.pdf">https://www.sparkfun.com/datasheets/Sensors/Temperature/DHT22.pdf</a> and
<a href="https://cdn-shop.adafruit.com/datasheets/Digital+humidity+and+temperature+sensor+AM2302.pdf">https://cdn-shop.adafruit.com/datasheets/Digital+humidity+and+temperature+sensor+AM2302.pdf</a></p>
</li>
<li>
<p>A regular reset of the sensor also may be required when sensor readings are ´jumping´: <a href="https://forum.arduino.cc/index.php?topic=355137.0">https://forum.arduino.cc/index.php?topic=355137.0</a></p>
</li>
</ul>
<!-- * To run a ESP8266 and a sensor on low power see [Low Power Modes](../boards/_lowpower.md) -->


      
        <h2>Tags</h2>
        <div class="taglist"><a href="/tag/element.htm">Element</a><a href="/tag/sensor.htm">Sensor</a></div>
      
  </main>

  <script>
    var mbObj = document.querySelector('#menuButton');
    var navObj = document.querySelector('nav');
    mbObj.addEventListener('click', function (e) {
      navObj.classList.toggle('open');
    });
    lazyLoadHTM('nav', '/toc.htm');
  </script>

  <script type="module" async>
    import mermaid from "https://unpkg.com/mermaid@10/dist/mermaid.esm.min.mjs";
    document.addEventListener('DOMContentLoaded', mermaid.initialize({startOnLoad: true}));
  </script>

</body>
</html>