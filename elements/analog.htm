<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="google-site-verification" content="7tTF0t5uCMnyE6X31OIOQpcOf4QxWuODtyZLoVsKCEc" />
  <meta name="msvalidate.01" content="7FC9C7BCD4002EBD89AAC2EF63D7B353" />
  <link rel="icon" type="image/png" href="favicon48.png" sizes="48x48">
  <meta name='description' content='Trigger events based on input voltage'>
  <title>Analog Element</title>
  <link Content-Type="text/css" href="/docstyle.css" rel="stylesheet" />
  <script src="/pages.js"></script>
  <style>
  .gpio { 
    display:inline-block;
    padding: 0 4px;
    border-radius: 4px;
    }
  .gpio.yellow {background-color: #FF0;}
  .gpio.red {background-color: #F22; color:white}
  .gpio.black {background-color: #111; color:white}
  .gpio.blue {background-color: #22F; color:white}
  </style>
</head>

<body scroll="0" style="padding:0;">
  <div class="u-navbar" style="margin-bottom: 0;">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" id="menuButton" class="button" style="height:1.4rem">
      <path fill="white" d="M0 8h48v6H0zm0 13h48v6H0zm0 13h48v6H0z" />
    </svg>

    <a href="/index.htm" class="button">Home</a>
    <a href="/concepts/index.htm" class="button">Concepts</a>
    <a href="/elements/index.htm" class="button">Elements</a>
    <a href="/boards/index.htm" class="button">Boards</a>
    <a href="/recipes/index.htm" class="button">Recipes</a>
  </div>

  <nav class="inpage open"></nav>

  <main style="padding:1rem">
    <h1>Analog Element</h1>

    
    
      <div class="iconcard"><svg class="icon"><use href="/icons.svg#analog"></use></svg>
    
    The AnalogElement is used to capture the voltage level from the Analog Input pin with the integrated ADC and to emit corresponding events. It also handles some of the often occurring problems around capturing analog values.
</div>
      
    <!--
## Web UI for the Analog Element

There is a dedicated card for this element available that will be used on the web server config and landing pages:
-->
<p>Analog input signals can be used for a wide range of use cases like capturing values from sensors with an analog output signal.</p>
<h2>Handling Analog signals</h2>
<p>There are some features implemented in the Analog Element that are useful when capturing analog signals.</p>
<ol>
<li>
<p>The analog input signals like such from analog sensors often have the characteristic that they constantly change around an average value. In many cases these small changes are not relevant to start an action and can be ignored.</p>
</li>
<li>
<p>To allow using the analog element in these situations a hysteresis can be defined. A new value is then only triggering an action when the current input value has more difference to the last reported value than specified. This eliminates the actions caused by small changes.
A hysteresis of 10 is the default value but you can specify any other value and especially 0 that eliminates this effect.</p>
</li>
<li>
<p>In other situations it is only relevant that a analog value is below or above a reference value.
By defining a reference value the reference action will only be dispatched when the input value goes above or below.</p>
</li>
</ol>
<p>On the ESP8266 chip the input value has a precision of 2^10 bits and the input value is represented as a value for 0 to 1024 measuring a voltage at the pin from 0 to 1 volts. The input measuring should not occur while the there is data transmitted over the WiFi because the value will be inaccurate.</p>
<h2>Element Configuration</h2>
<p><object data="/element.svg?analog" type="image/svg+xml"></object></p>
<p>The following properties are available for configuration of the element:</p>
<blockquote>
<p><strong>readtimems</strong> - The time between capturing input values in milliseconds.</p>
<p><strong>hysteresis</strong> - The value action is emitted only when the value differs more than defined by hysteresis. Default=10.</p>
<p><strong>reference</strong> - The reference action is emitted when the value goes below / above the reference value.</p>
<p><strong>mapInMin</strong> - This is the lower bound of the raw value. This will be mapped to the value given by <strong>mapOutMin</strong>.</p>
<p><strong>mapInMax</strong> - This is the upper bound of the raw value. This will be mapped to the value given by <strong>mapOutMax</strong>.</p>
<p><strong>mapOutMin</strong> - This is the lower bound of the output value.</p>
<p><strong>mapOutMax</strong> - This is the upper bound of the output value.</p>
<p><strong>onValue</strong> - These actions are emitted when the input level has changed.</p>
<p><strong>onReference</strong> -These actions are emitted when the input level goes across the reference level.</p>
<p><strong>onHigh</strong> - These actions are send when the value is above the reference value.
The value given in the actions is <code>1</code>.</p>
<p><strong>onLow</strong> - These actions are send when the value is below the reference value.
The value given in the actions is <code>0</code>.</p>
</blockquote>
<p>The ESP8266 chip has only one analog input pin so specifying a pin is not required.</p>
<p>From the base element implementation the following properties are available for configuration:</p>
<blockquote>
<p><strong>title</strong> - Caption text for the element. Used by the element specific cards on the dash boards.</p>
<p><strong>description</strong> - A line of text that gives a short description of the device used in the web UI.</p>
<p><strong>room</strong> - The location of the device.</p>
<p><strong>loglevel</strong> - This property holds the element specific log level. The default value is LOGGER_LEVEL_ERR == 1.</p>
</blockquote>
<p>* This parameter must be specified.</p>
<h3>Example Configuration</h3>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"analog"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"0"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>      <span class="token property">"reference"</span> <span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span><br>      <span class="token property">"onvalue"</span><span class="token operator">:</span> <span class="token string">"device/0?log=analogvalue=$v"</span><span class="token punctuation">,</span><br>      <span class="token property">"onreference"</span><span class="token operator">:</span> <span class="token string">"device/0?log=analogref=$v"</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<h3>More Examples</h3>
<p>A water sensor that is used to detect water on the floor may have some small current leakages but when there is real water coming to the sensor the measured value rises significantly. A reference action can be the solution.</p>
<p>A analog sensing element for weight can produce many values around. When the weight changes significantly a value action can be used. Small changes that occur by movements of the weight can be filtered out by specifying a hysteresis value.</p>
<h2>State</h2>
<p>The following properties are available with the current values at runtime</p>
<blockquote>
<p><strong>active</strong> - Is set to true when the element is active.</p>
<p><strong>rawvalue</strong> - This is the original value from the ADC pin.</p>
<p><strong>value</strong> - When no mapping boundaries are given this is equal the raw value.
When mapping boundaries are given this is the calculated value.</p>
<p><strong>reference</strong> - This is 1 when the value is above the reference value otherwise 0.</p>
</blockquote>
<h3>Example State</h3>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"analog/0"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"active"</span><span class="token operator">:</span><span class="token string">"true"</span><span class="token punctuation">,</span><br>    <span class="token property">"value"</span><span class="token operator">:</span><span class="token string">"13"</span><span class="token punctuation">,</span><br>    <span class="token property">"rawvalue"</span><span class="token operator">:</span><span class="token string">"721"</span><span class="token punctuation">,</span><br>    <span class="token property">"reference"</span><span class="token operator">:</span><span class="token string">"0"</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<h2>See also</h2>
<ul>
<li><a href="https://www.esp8266.com/wiki/doku.php?id=esp8266_gpio_pin_allocations">https://www.esp8266.com/wiki/doku.php?id=esp8266_gpio_pin_allocations</a></li>
</ul>


    
    <h2>Tags</h2>
    <div class="taglist"><a href="/tag/element.htm">Element</a><a href="/tag/input.htm">Input</a><a href="/tag/sensor.htm">Sensor</a></div>
    
  </main>

  <script>
    var mbObj = document.querySelector('#menuButton');
    var navObj = document.querySelector('nav');

    navObj.classList.toggle('open', (window.innerWidth > 880));

    mbObj.addEventListener('click', function (e) {
      navObj.classList.toggle('open');
    });

    lazyLoadHTM('nav', '/toc.htm');
  </script>
  
  </body>

</html>