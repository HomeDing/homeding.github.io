
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BME680 Element</title>
  <script src="/pages.js"></script>
  <link content-type="text/css" href="/docstyle.css" rel="stylesheet">
  <script src="/story.js" type="module"></script>
  <link rel="icon" type="image/png" href="/favicon48.png" sizes="48x48">
  <meta name="description" content="Support the BME680 environment air sensor chip.">
  <meta name="google-site-verification" content="7tTF0t5uCMnyE6X31OIOQpcOf4QxWuODtyZLoVsKCEc">
  <meta name="msvalidate.01" content="7FC9C7BCD4002EBD89AAC2EF63D7B353">
</head>

<body class="sitelayout">
  <div class="navbar">
    <button id="menu" popovertarget="my-menu">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
        <path fill="white" d="M0 8h48v6H0zm0 13h48v6H0zm0 13h48v6H0z"></path>
      </svg>
    </button>
    <a href="/index.htm" class="button">Home</a>
    <a href="/elements/index.htm" class="button">Elements</a>
    <a href="/boards/index.htm" class="button">Boards</a>
    <a href="/recipes/index.htm" class="button">Recipes</a>
    
  </div>
  
  <nav popover="auto" id="my-menu" class="menu"></nav>

  <main>
    <h1>BME680 Element</h1>

    
      <div class="card-container horizontal text" style="--card-height:5rem;--card-image-size:5rem;">
        <div class="card">
          
            <svg>
              <use href="/icons.svg#bme680"></use>
            </svg>
          
          <div class="body">
            <p>The BME680Element implements reading the 4 sensor values from a BME680 environment air sensor chip. This sensor can capture temperature, humidity, air pressure and air resistance.</p>

          </div>
        </div>
      </div>
    

    <p>The Element implementation uses the Bosch bme680 sensor library that comes with the element implementation and need no further installation.
It uses the I2C bus for connection.</p>
<p>To make it available for configuration it needs to be included into the compilation by activating it using the macro</p>
<p>The Element is included in the standard firmware but can be excluded to save memory by removing the definition:</p>
<pre class="language-cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">HOMEDING_INCLUDE_BME680</span></span></code></pre>
<p>in the element register section of the sketch.</p>
<h2>Sensor Connectivity</h2>
<p>The sensor chip uses a 3.3 V Supply voltage on VCC and GND and needs to be connected to the SDA and SCL line of the I2C bus.
The I2C pins are configured using the properties of the <a href="/elements/device.htm">device element</a> and the I2C bus is normally shared by multiple elements e.g. sensors.</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"device"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"0"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"i2c-scl"</span><span class="token operator">:</span> <span class="token string">"D2"</span><span class="token punctuation">,</span>
      <span class="token property">"i2c-sda"</span><span class="token operator">:</span> <span class="token string">"D1"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>The I2C address of the sensor is 0x77 = 119 by default and is configured using the element configuration.
The chip offers the possibility using an alternate address. Please refer to the documentation of your sensor board.</p>
<p>Using the default I2C bus pins:</p>
<table>
<thead>
<tr>
<th>Signal</th>
<th>ESP8266</th>
<th>ESP32</th>
<th>Sensor</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><span class="gpio black">GND</span></td>
<td>GND</td>
<td>GND</td>
<td>GND</td>
<td>Ground for I2C and Power Supply</td>
</tr>
<tr>
<td><span class="gpio red">VCC</span></td>
<td>3.3v</td>
<td>3.3v</td>
<td>VCC/VDD</td>
<td>Power Supply</td>
</tr>
<tr>
<td><span class="gpio blue">SDA</span></td>
<td>GPIO4(D2)</td>
<td>IO21</td>
<td>SDA</td>
<td>I2C Data Signal</td>
</tr>
<tr>
<td><span class="gpio yellow">SCL</span></td>
<td>GPIO5(D1)</td>
<td>IO22</td>
<td>SCL</td>
<td>I2C Clock Signal</td>
</tr>
<tr>
<td></td>
<td>-</td>
<td>-</td>
<td>SDD</td>
<td>not used</td>
</tr>
<tr>
<td></td>
<td>-</td>
<td>-</td>
<td>CS</td>
<td>not used in I2C Mode</td>
</tr>
</tbody>
</table>
<p><img src="/elements/bme680.jpg" alt="BME680 wiring"></p>
<h2>Element Configuration</h2>
<p><object data="/element.svg?bme680" type="image/svg+xml"></object></p>
<p>These properties can be configured:</p>
<p><strong>address</strong> The I2C Address of the sensor. The default value is 0x77 the other possible value is 0x76.</p>
<p><strong>readTime</strong> Time between 2 probes from the sensor are fetched. The default value is 1 minute.</p>
<h3>Configuration Example</h3>
<p>This example shows how to configure this element:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"bme680"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"bd"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"address"</span><span class="token operator">:</span> <span class="token string">"0x77"</span><span class="token punctuation">,</span>
      <span class="token property">"readtime"</span><span class="token operator">:</span> <span class="token string">"10s"</span><span class="token punctuation">,</span>
      <span class="token property">"ontemperature"</span><span class="token operator">:</span> <span class="token string">"device/0?log=temp=$v"</span><span class="token punctuation">,</span>
      <span class="token property">"onhumidity"</span><span class="token operator">:</span> <span class="token string">"device/0?log=humidity=$v"</span><span class="token punctuation">,</span>
      <span class="token property">"onpressure"</span><span class="token operator">:</span> <span class="token string">"device/0?log=pressure=$v"</span><span class="token punctuation">,</span>
      <span class="token property">"ongas"</span><span class="token operator">:</span> <span class="token string">"device/0?log=gas=$v"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h2>Outbound Actions</h2>
<p>The actions emitted by the BME680 Element has read some new data (with changed value) from the sensor.</p>
<p><strong>onTemperature</strong> - These actions are send when a new temperature value has been read. The value given in the actions is actual temperature in Celcius.</p>
<p><strong>onHumidity</strong> - These actions are send when a new temperature value has been read. The value given in the actions is actual Humidity in percentage.</p>
<p><strong>onPressure</strong> - These actions are send when a new pressure value has been read. The value given in the actions is actual pressure in hPA.</p>
<p><strong>onGas</strong> - These actions are send when a new gas resistance value has been read. The value given in the actions is actual gas resistance value in kOhm.</p>
<h2>State</h2>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"bme680/0"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"active"</span><span class="token operator">:</span><span class="token string">"true"</span><span class="token punctuation">,</span>
    <span class="token property">"temperature"</span><span class="token operator">:</span><span class="token string">"21.21"</span><span class="token punctuation">,</span>
    <span class="token property">"humidity"</span><span class="token operator">:</span><span class="token string">"43.48"</span><span class="token punctuation">,</span>
    <span class="token property">"pressure"</span><span class="token operator">:</span><span class="token string">"99784"</span><span class="token punctuation">,</span>
    <span class="token property">"gas"</span><span class="token operator">:</span><span class="token string">"72724"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h2>Interpreting the GAS-OHM values</h2>
<p>There are some discussions about how to interpret the values from the gas sensor.</p>
<p>The number is not related directly to quality of the air and Bosch supports a (closed source) library to calculate a proprietary Air Quality Index (IAQ).</p>
<p>Here is a link on how to integrate the algorithm from BOSCH that can be found in the the BSEC SDK:</p>
<ul>
<li><a href="https://www.bosch-sensortec.com/bst/products/all_products/bsec">https://www.bosch-sensortec.com/bst/products/all_products/bsec</a> Bosch Sensortec Software Downloads</li>
<li><a href="https://wolfgangklenk.wordpress.com/2017/11/05/indoor-air-quality-iaq-measurement-with-bosch-bme680-and-stm32f103c8t6/">https://wolfgangklenk.wordpress.com/2017/11/05/indoor-air-quality-iaq-measurement-with-bosch-bme680-and-stm32f103c8t6/</a> A example using the BOSCH SDK directly.</li>
</ul>
<p>I avoid this huge library for now.</p>
<p>However there is a table driven and a formula driven approach for some mapping of the sensor values to a Quality Indicator available. The humidity of the air might be a good factor for the calculation of “good” air quality.</p>
<table>
<thead>
<tr>
<th>range</th>
<th>quality</th>
</tr>
</thead>
<tbody>
<tr>
<td>521177 - 431331</td>
<td>good</td>
</tr>
<tr>
<td>297625 - 213212</td>
<td>average</td>
</tr>
<tr>
<td>148977 - 108042</td>
<td>little bad</td>
</tr>
<tr>
<td>75010 - 54586</td>
<td>bad</td>
</tr>
<tr>
<td>37395 - 27080</td>
<td>worse</td>
</tr>
<tr>
<td>18761 - 13591</td>
<td>very bad</td>
</tr>
<tr>
<td>9008 - 8371</td>
<td>totally bad</td>
</tr>
</tbody>
</table>
<ul>
<li><a href="https://forums.pimoroni.com/t/bme680-observed-gas-ohms-readings/6608">https://forums.pimoroni.com/t/bme680-observed-gas-ohms-readings/6608</a></li>
<li><a href="https://github.com/G6EJD/BME680-Example">https://github.com/G6EJD/BME680-Example</a> Here you find an example for BME680 that calculates a quality index by combining a quality from gas and humidity.</li>
</ul>
<h2>See also</h2>
<ul>
<li><a href="/dev/i2c.htm">Using the I2C bus</a></li>
<li><a href="https://ae-bst.resource.bosch.com/media/_tech/media/datasheets/BST-BME680-DS001.pdf">https://ae-bst.resource.bosch.com/media/_tech/media/datasheets/BST-BME680-DS001.pdf</a>
The official DataSheet</li>
<li><a href="https://www.bosch-sensortec.com/bst/products/all_products/bme680">https://www.bosch-sensortec.com/bst/products/all_products/bme680</a> Product description</li>
<li><a href="https://github.com/boschsensortec/Bosch-BME68x-Library">https://github.com/boschsensortec/Bosch-BME68x-Library</a> Bosch, the manufacturer of the sensor has published an sdk for this sensor</li>
<li><a href="https://myesp8266.blogspot.com/2016/12/bmp280-and-esp8266.html">https://myesp8266.blogspot.com/2016/12/bmp280-and-esp8266.html</a> Another illustrated example using the Adafruit library.</li>
</ul>


      
        <h2>Tags</h2>
        <div class="taglist"><a href="/tag/element.htm">Element</a><a href="/tag/sensor.htm">Sensor</a></div>
      
  </main>

  <script>
    

    var navObj = document.querySelector('nav');
    lazyLoadHTM('nav', '/toc.htm');
  </script>

</body>
</html>