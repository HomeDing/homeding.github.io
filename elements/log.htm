
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="7tTF0t5uCMnyE6X31OIOQpcOf4QxWuODtyZLoVsKCEc"/>
    <meta name="msvalidate.01" content="7FC9C7BCD4002EBD89AAC2EF63D7B353"/>
    <link rel="icon" type="image/png" href="/favicon48.png" sizes="48x48">
    <title>Log Element</title>
    <meta name='description' content='Support logging of values into a file in the filesystem.'>
    <link content-type="text/css" href="/docstyle.css" rel="stylesheet"/>
    <script src="/pages.js"></script>
    <script src="/story.js" type="module"></script>
  </head>
  <body scroll="0" style="padding:0;">
    <div class="u-navbar" style="margin-bottom: 0;">
      <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 48 48" id="menuButton" class="button" style="height:1.4rem">
        <path fill="white" d="M0 8h48v6H0zm0 13h48v6H0zm0 13h48v6H0z"/>
      </svg>
      <a href="/index.htm" class="button">Home</a>
      <a href="/elements/index.htm" class="button">Elements</a>
      <a href="/boards/index.htm" class="button">Boards</a>
      <a href="/recipes/index.htm" class="button">Recipes</a>
    </div>
    <nav></nav>
    <main style="padding:1rem;max-width: 800px;">
      <h1>Log Element</h1>
      
        
          <div class="iconcard">
            <svg class="icon">
              <use href="/icons.svg#log"></use>
            </svg>
          
            The LogElement enables storing timestamp based values e.g. from a sensor into a local file to be analyzed or displayed later by the Web UI.

          </div>
        
        <p>This enables using sensor values to be displayed in graphs in the Web UI for this element.</p>
<p>The LogElement also supports calculating average values based on the values given for a time period.</p>
<p>For this element a visualization of the values in the log files is available that shows up as a line chart:</p>
<p><img src="/dev/microchart-line.png" alt="Log linechart"></p>
<p>By reading the files directly they are available as sources for other purpose like analysis in excel as well.</p>
<h2>Element Configuration</h2>
<p>The following properties are available for configuration and operating of the element:</p>
<p><object data="/element.svg?log" type="image/svg+xml"></object></p>
<p><strong>value</strong> - To record numeric values the value action can be sent to this element e.g. with the current sensor value.</p>
<p><strong>filename</strong> - Name of the main logfile.</p>
<p><strong>filesize</strong> - Maximum size of the logfile. The default is about 4 kBytes.</p>
<p><strong>averagetime</strong> - This is the duration of an interval where all incoming values are used to calculate the average value.
When not set every value is recorded individually.</p>
<p>The UI Widget of the Log Element you find on the dashboard can be configured by using the following properties:</p>
<p><strong>xFormat</strong> - datatype used to the first log value on the linechart, typically a timestamp.
The default is <code>datetime</code>.</p>
<p><strong>yFormat</strong> - datatype used to the second log value on the linechart, typically a meassured value.
The default is <code>num</code>.</p>
<p>See <a href="/dev/microchart-line.htm">Line Microchart</a> for supported data types.</p>
<p>From the base element implementation the following properties are available for configuration:</p>
<blockquote>
<p><strong>title</strong> – Caption text for the element. Used by the element specific cards on the dash boards.</p>
<p><strong>description</strong> – A line of text that gives a short description of the device used in the web UI.</p>
<p><strong>room</strong> – The location of the device.</p>
<p><strong>loglevel</strong> – This property holds the element specific log level. The default value is LOGGER_LEVEL_ERR == 1.</p>
<p><strong>startup</strong> – This property can be used to start the element using a different initialization phase.
Possible values are “sys”, “net”, “time”. See <a href="/dev/startup.htm">The Startup sequence</a>.</p>
</blockquote>
<h3>Configuration Example</h3>
<p>This example shows how to configure this element:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"log"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"temp"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"outside temperature"</span><span class="token punctuation">,</span>
      <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"collecting temperature values on a 10 min. interval."</span><span class="token punctuation">,</span>
      <span class="token property">"averagetime"</span><span class="token operator">:</span> <span class="token string">"00:10:00"</span><span class="token punctuation">,</span>
      <span class="token property">"filesize"</span><span class="token operator">:</span> <span class="token string">"10000"</span><span class="token punctuation">,</span>
      <span class="token property">"filename"</span><span class="token operator">:</span> <span class="token string">"/templog.txt"</span><span class="token punctuation">,</span>
      <span class="token property">"yFormat"</span><span class="token operator">:</span> <span class="token string">"num:2"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h2>Element State</h2>
<p>The following properties are available with the current values at runtime:</p>
<p><strong>active</strong> - Is set to true when the element is active.</p>
<p><strong>value</strong> - The last recorded value.</p>
<h3>Example State</h3>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"log/t"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"active"</span><span class="token operator">:</span><span class="token string">"true"</span><span class="token punctuation">,</span>
    <span class="token property">"value"</span><span class="token operator">:</span><span class="token string">"15.91"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h2>Implementation Details</h2>
<p>When the configured file size is reached the current file is renamed from &lt;filename&gt;.txt to &lt;filename&gt;_old.txt and a new
&lt;filename&gt;.txt is started.</p>
<p>The files format is a list of CSV values where the current javascript time (seconds since 01.01.1970) is used in the first column.</p>
<p>Example:</p>
<pre class="language-json"><code class="language-json"><span class="token number">1558409166</span><span class="token punctuation">,</span><span class="token number">15</span>
<span class="token number">1558409466</span><span class="token punctuation">,</span><span class="token number">16</span>
<span class="token number">1558409766</span><span class="token punctuation">,</span><span class="token number">18</span>
<span class="token number">1558410066</span><span class="token punctuation">,</span><span class="token number">22</span>
<span class="token number">1558410366</span><span class="token punctuation">,</span><span class="token number">19</span>
<span class="token number">1558410666</span><span class="token punctuation">,</span><span class="token number">12</span>
<span class="token number">1558410966</span><span class="token punctuation">,</span><span class="token number">9</span>
<span class="token number">1558411266</span><span class="token punctuation">,</span><span class="token number">7</span>
<span class="token number">1558411566</span><span class="token punctuation">,</span><span class="token number">7</span>
<span class="token number">1558411866</span><span class="token punctuation">,</span><span class="token number">6</span></code></pre>
<p>When using the <code>averagetime</code> parameter a new interval is started with a first value.
The interval terminates automatically when the <code>averagetime</code> is over.
This results in no recordings when a sensor is not giving values.</p>
<!-- 
## Logging multiple sensor values

**TO BE IMPLEMENTED**

Most sensors can detect the actual value e.g. from the environment from a range of values.
These values are of interest even when the moment of the value detection is in the past and therefore can be saved to a permanent storage using the log element.

When the log element retrieves an actions that contain the current values of a sensor this will be saved to disk together with the current timestamp using a file with a format CSV.

The timestamp in the logfile is expressed using time_t values as integers as defined in the C++/CPP SDKs in seconds.
To make this a JavaScript Date to factor 1000 must be applied because Javascript has Date values in milliseconds.


It is possible to collect multiple values at once and they are added to the logfile as additional columns.

It is possible to pass multiple values that are separated by a `;` character in one action. Single values can be passed by using the the array syntax like `value[1]`. This is especially useful in combination with the interval parameter to log values from multiple sources in one log record.

The notation `value[0]=` is equal to using `value=` with a single value.

-->

        
          <h2>Tags</h2>
          <div class="taglist">
            
              <a href="/tag/element.htm">Element</a>
            
          </div>
        
      </main>
      <script>
        const param = {
          MENU_MIN_WIDTH: 1030
        };
        var mbObj = document.querySelector('#menuButton');
        var navObj = document.querySelector('nav');
        if (window.innerWidth > param.MENU_MIN_WIDTH) { // menu is inside the page
          navObj.classList.add('open');
          navObj.classList.add('inpage');
        }
        mbObj.addEventListener('click', function (e) {
          navObj.classList.toggle('open');
        });
        lazyLoadHTM('nav', '/toc.htm');
      </script>

      <script type="module" async>
        import mermaid from "https://unpkg.com/mermaid@10/dist/mermaid.esm.min.mjs";
        document.addEventListener('DOMContentLoaded', mermaid.initialize({startOnLoad: true}));
      </script>

    </body>
  </body>
</html>