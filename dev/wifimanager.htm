<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="google-site-verification" content="7tTF0t5uCMnyE6X31OIOQpcOf4QxWuODtyZLoVsKCEc" />
  <meta name="msvalidate.01" content="7FC9C7BCD4002EBD89AAC2EF63D7B353" />
  <link rel="icon" type="image/png" href="favicon48.png" sizes="48x48">
  <title>WiFi Manager Details</title>
  <meta name='description' content='Examples and documentation for the HomeDing IoT Library'>
  <link Content-Type="text/css" href="/docstyle.css" rel="stylesheet" />
  <script src="/pages.js"></script>
  <script src="/story.js" type="module"></script>
  <style>
  .gpio { 
    display:inline-block;
    padding: 0 4px;
    border-radius: 4px;
    }
  .gpio.yellow {background-color: #FF0;}
  .gpio.red {background-color: #F22; color:white}
  .gpio.black {background-color: #111; color:white}
  .gpio.blue {background-color: #22F; color:white}
  </style>
</head>

<body scroll="0" style="padding:0;">
  <div class="u-navbar" style="margin-bottom: 0;">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" id="menuButton" class="button" style="height:1.4rem">
      <path fill="white" d="M0 8h48v6H0zm0 13h48v6H0zm0 13h48v6H0z" />
    </svg>

    <a href="/index.htm" class="button">Home</a>
    <a href="/elements/index.htm" class="button">Elements</a>
    <a href="/boards/index.htm" class="button">Boards</a>
    <a href="/recipes/index.htm" class="button">Recipes</a>
  </div>

  <nav></nav>

  <main style="padding:1rem;max-width: 800px;">
    <h1>WiFi Manager Details</h1>

    
    
      <div class="plaincard">
    
    The WiFi-Manager is a module in the HomeDing library to register a device in the local network. It is implemented in every device in the board class.
When the device has not been connected to the local home network the Wifi-Manager exposes a temporary, unprotected Wifi Network named HomeDingNNNNNN using the 192.168.4.xxx ip range. The device is always available on the URL &lt;http://192.168.4.1/&gt;.
Any device like mobile phone or laptop with WLAN can join this network for configuration.
</div>
      
    <p>There is a walk-through description on how to use the WiFi Manager in <a href="/steps/newdevice.htm">Step by Step Bring your device to work</a>.</p>
<h2>Start WiFi Manager</h2>
<p>The WiFi Manager will automatically be started when no previous network and no configured network could be found.</p>
<p>The WiFi Manager can be started by pressing then sys button during the connect attempts or
by resetting the device without power loss 2 times in a row.</p>
<p>See <a href="/dev/startupnet.htm">The Network Startup Sequence</a> for details.</p>
<h2>Wifi Setup Dialog</h2>
<p>The dialog that enables selecting an available network and entering the corresponding network passphrase
is available on every device by using the <strong>/$setup.htm</strong> URL.</p>
<ul>
<li>
<p>The device opens a new open WiFi network
named <code>HomeDingNNNNNN</code> where NNNNNN is a hex value derived from the mac address so somehow unique.</p>
<p>On this WiFi the device is reachable on the fixed IP address 192.168.4.1 and the dialog is available
using the <a href="http://192.168.4.1/$setup.htm">http://192.168.4.1/$setup.htm</a> URL.</p>
</li>
<li>
<p>The setup dialog is also available when the device has a network registration
and is available on the local network using <a href="http://homeding/$setup.htm">http://homeding/$setup.htm</a></p>
</li>
<li>
<p>The setup dialog will show the available networks after some seconds to choose one.</p>
</li>
<li>
<p>The network passphrase must be entered in the form.</p>
</li>
</ul>
<p>In this dialog will automatically be shown when starting the plain url of the device while beeing in WiFi Manager Mode.</p>
<p>The Wifi Setup Dialog can also be used while the device is connected and running
to re-configure the device to join another network.</p>
<h2>System LED</h2>
<p>when a System LED is configured in the device configuration the following signals can be seen:</p>
<table>
<thead>
<tr>
<th>state of the device</th>
<th>frequency</th>
<th>signal form</th>
</tr>
</thead>
<tbody>
<tr>
<td>connecting to network in safe mode</td>
<td>1 per 700msec.</td>
<td>fast long pulse</td>
</tr>
<tr>
<td>connecting to network in unsafe mode</td>
<td>1 per 700msec.</td>
<td>fast short pulse</td>
</tr>
<tr>
<td>WiFi Manager mode</td>
<td>1 per 3 sec.</td>
<td>slow short signal</td>
</tr>
</tbody>
</table>
<h2>Restart</h2>
<p>After 5 minutes the WiFiManager will stop itself and the device will be rebooted. This will bring the device back into the regular operating mode in the case the local network had an outage and WiFiManager was started caused by power failures or a temporary missing network.</p>
<p>Under normal operating conditions when the device was previously added to a network
the startup sequence automatically connects the device to the last known network. This typically needs a few seconds only.</p>
<h2>WiFiManager UI</h2>
<p>The WiFiManager presents a minimal UI that shows some minimal information about the device and a form to configure the secured network access.</p>
<p><img src="/dev/wifimanager.png" alt="WiFiManager dialog"></p>
<ul>
<li>The current devicename is displayed.</li>
<li>In the Network drop-down the local available WiFi networks are listed and the right network can be selected.</li>
<li>The passphrase for this network needs to be entered.</li>
<li>When reloading the page the available networks will be scanned again.</li>
<li>Using the <code>Connect</code> button the device tries to connect the selected network and then reboots into the normal operation mode.</li>
</ul>
<p>The WiFi manager UI can also be accessed during normal operation using the link <a href="http://%7Bdevicename%7D/$setup.htm">http://{devicename}/$setup.htm</a>.</p>
<p>How to bring a device from an empty board into full operating can be found in <a href="/steps/newdevice.htm">Setup a new device Step by Step</a></p>
<h2>WiFi Manager Configuration</h2>
<p>The WiFi Manager can be configured by some properties of the <a href="/elements/device.htm">Device Element</a>.</p>
<p><strong>led</strong> - The device uses this GPIO pin to drive a LED that is blinking while the Board waits for a network connection to be established after booting. During this time the WiFi Manager can be started using the button.
Defaults is <code>no LED</code>.</p>
<p><strong>button</strong> - The board uses this GPIO pin to start WiFi Manager after booting when the level is pulled down while the LED is blinking.
Defaults is <code>GPIO0(D3)</code></p>
<p><strong>connectTime</strong> - The available time after a reboot of the device to start network configuration. Default: “6s”.</p>
<h2>Reset the network configuration</h2>
<p>The network configuration includes the network name and the network password. This is not configured in a configuration file but stored in a special non volatile memory together with some network parameters that allows fast rejoining the existing network that was connected successfully before.</p>
<p>The device can be reset and forgets the network configuration when calling the url <a href="http://homeding/$reset">http://homeding/$reset</a>.</p>
<h2>Information in the Serial Monitor</h2>
<p>A device starting without a network configuration will go into WiFi Manager mode.</p>
<p>The information you can find in the Log on the Serial Monitor includes:</p>
<p>00:00:03 sys:i Device starting…
00:00:03 &gt;HomeDing                    // Startup Welcome Message
00:00:03 &gt;config… HomeDing5D26A5     // Config mode and Name of Setup-Network
00:00:03 sys:i  AP-IP: 192.168.4.1    // IP Address of the device</p>
<p>After choosing the network and entering the passPhrase in the setup dialog using <a href="http://192.168.4.1/$setup">http://192.168.4.1/$setup</a>:</p>
<p>00:01:07 &gt;setup network DEVNET        // chosen Network name
00:01:15 &gt;ok.                         // access could be established
00:01:15 sys:i reboot…              // reboot for new configuration</p>
<p>A regular startup will follow:</p>
<p>00:00:03 sys:i Device starting…
00:00:03 &gt;HomeDing                    // Startup Welcome Message
00:00:13 &gt;ESP-5D26A5 192.168.2.229    // Device name and IP address on the new network
00:00:13 sys:i ESP-5D26A5 (192.168.2.229) connected to DEVNET (unsafe mode)</p>
<p>The device is now reachable using <a href="http://ESP-5D26A5">http://ESP-5D26A5</a> or <a href="http://192.168.2.229">http://192.168.2.229</a></p>
<!-- ## WPS
NOT IMPLEMENTED YET

``` cpp
bool ESPSerialWiFiManager::_connect_wps(){
  _disconnect();
  OFL("Push the WPS button on your access point now.");
  String opt = _prompt("Press Enter when complete (q to abort)");
  if(CHAROPT(opt[0], 'q')) return false;
  OFL("Attempting WPS connection. May take some time...");
  if (WiFi.beginWPSConfig()){
    String ssid = WiFi.SSID();
    if(ssid.length() > 0){
        OL("\nSuccess! Connected to network " + ssid);
        NL();
        _disp_network_details();
        NL();
        _save_config(ssid, WiFi.psk(), true);
        return true;
    }
    else{
        return false;
    }
  }
}
```
-->
<h2>More</h2>
<!--
* <https://esp-forum.de/index.php/forum/codebesprechung/35-wifi-mode-fuer-ap-und-sta-richtig-anwenden>
* <https://www.hackster.io/kosme/esp8266-sniffer-9e4770?utm_campaign=new_projects&utm_content=0&utm_medium=email&utm_source=hackster&utm_term=project_name>
-->
<ul>
<li>WPS Option: <a href="https://bbs.espressif.com/viewtopic.php?t=1096">https://bbs.espressif.com/viewtopic.php?t=1096</a></li>
<li><a href="https://github.com/rudi48/WiFiTelnetToSerialWPS/blob/master/WiFiTelnetToSerialWPS.ino">https://github.com/rudi48/WiFiTelnetToSerialWPS/blob/master/WiFiTelnetToSerialWPS.ino</a></li>
<li>tips: <a href="http://bienonline.magix.net/public/arduino-wifi.html">http://bienonline.magix.net/public/arduino-wifi.html</a></li>
<li><a href="https://maniacallabs.com/2016/08/09/new-library-esp-serial-wifi-manager/">https://maniacallabs.com/2016/08/09/new-library-esp-serial-wifi-manager/</a></li>
<li><a href="https://github.com/r-downing/PersWiFiManager">https://github.com/r-downing/PersWiFiManager</a></li>
</ul>
<!--
* <https://github.com/esp8266/Arduino/issues/2735>
* <https://internetofhomethings.com/homethings/?p=631>
-->


    
    <h2>Tags</h2>
    <div class="taglist"><a href="/tag/implementation.htm">Implementation</a></div>
    
  </main>

  <script>
    const param = {
      MENU_MIN_WIDTH: 1030
    };

    var mbObj = document.querySelector('#menuButton');
    var navObj = document.querySelector('nav');

   if (window.innerWidth > param.MENU_MIN_WIDTH) {
      // menu is inside the page
      navObj.classList.add('open');
      navObj.classList.add('inpage');
    }

    mbObj.addEventListener('click', function (e) {
      navObj.classList.toggle('open');
    });

    lazyLoadHTM('nav', '/toc.htm');
  </script>
  
  </body>

</html>