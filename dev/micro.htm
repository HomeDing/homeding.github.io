
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="7tTF0t5uCMnyE6X31OIOQpcOf4QxWuODtyZLoVsKCEc"/>
    <meta name="msvalidate.01" content="7FC9C7BCD4002EBD89AAC2EF63D7B353"/>
    <link rel="icon" type="image/png" href="/favicon48.png" sizes="48x48">
    <title>Micro Implementations Details</title>
    <meta name='description' content='Examples and documentation for the HomeDing IoT Library'>
    <link content-type="text/css" href="/docstyle.css" rel="stylesheet"/>
    <script src="/pages.js"></script>
    <script src="/story.js" type="module"></script>
  </head>
  <body scroll="0" style="padding:0;">
    <div class="u-navbar" style="margin-bottom: 0;">
      <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 48 48" id="menuButton" class="button" style="height:1.4rem">
        <path fill="white" d="M0 8h48v6H0zm0 13h48v6H0zm0 13h48v6H0z"/>
      </svg>
      <a href="/index.htm" class="button">Home</a>
      <a href="/elements/index.htm" class="button">Elements</a>
      <a href="/boards/index.htm" class="button">Boards</a>
      <a href="/recipes/index.htm" class="button">Recipes</a>
    </div>
    <nav></nav>
    <main style="padding:1rem;max-width: 800px;">
      <h1>Micro Implementations Details</h1>
      
        <p>There are many frameworks for building a Web UI but when implementing on a memory restricted device the size of basis functionality and components becomes the most limiting factor and therefore the HomeDing UI implementation has to be as small as possible and provides only the required functionality to visualize the internal available elements, the actions and their state.</p>
<h2>Using the Single Page Application (SPA) implementation pattern</h2>
<p>By using the SPA pattern the server needs to implement</p>
<ul>
<li>the delivery of static files for loading the web application into the browser</li>
<li>acting on Ajax calls to the web server to get data and trigger functionality.</li>
</ul>
<p>This is a good architecture for the web browsers available on desktops and phones. Modern frameworks like Angular, react or Vue give you a good set of tools to efficiently implement applications. However, the size of these applications tends to get huge.</p>
<p>In contrast to these full-blown frameworks the micro frameworks offer only the essential required functionality. They support better the current available boards for IoT things that will not have enough space nor enough power to host server web applications like those built in Angular, react or Vue.</p>
<p>The HomeDing library is also using this approach by using “micro” implementations to minimize the footprint of the downloaded files.</p>
<h2>The Micro Implementations</h2>
<p>By using the following micro implementations a small component framework is available that fits in to web servers with the space restrictions we can find in the boards and chips.</p>
<p><strong>The micro IDE</strong> is a simple text editing utility primary use case is to modify the env.json and config.json configuration files.
More in: <a href="/dev/microide.htm">Micro IDE</a></p>
<p><strong>The micro templates</strong> are used to build HTML components that can be used at different places to visualize elements, data and other UI components like dialogs.
More in: <a href="/dev/microtemplates.htm">Micro Templates</a></p>
<p><strong>The micro behaviors</strong> are modules covering the functionality required to work with a component itself.
More in: <a href="/dev/microbehaviors.htm">Micro Behaviors</a></p>
<p><strong>The micro databinding</strong> is the functionality to transfer data from the device or other JSON formatted data into the HTML components.</p>
<p><strong>The micro stylesheet</strong> contains a collection of CSS rules that are available in a central file. By using the SCSS technology the resulting CSS file can be compressed to save memory and bandwidth while offering a well structured input.</p>
<p><strong>Icons</strong> are available for all elements and general purpose. They are implemented in SVG format that results in minimal size while supporting a good  scalability.
<br />More in: <a href="/dev/microicons.htm">Micro Icons</a></p>
<p><strong>Charts</strong> There are some charting elements available for the HTML UI that are implemented using SVG and JavaScript.
They are implemented in SVG format that results in minimal size while supporting a good  scalability.
<br />More in: <a href="/dev/microcharts.htm">Micro Charts</a></p>
<h2>Web Site on board</h2>
<p>The HomeDing library comes with a web server implementation and a small web site that can be stored in the file system of a ESP8266 base device that offers the following pages:</p>
<ul>
<li>A home page providing a static welcome screen and some further navigation links.</li>
<li>A <a href="/dev/dashboard.htm">dashboard</a> that presents all active elements and their actual data.</li>
<li>A minimal web-based IDE page that allows changing the text based files of the web server including the configuration files.</li>
<li>A generic diagram that displays all existing elements and the configured actions in between.</li>
</ul>
<p>This functionality or at least a part of it is required even for even small HomeDing based devices and needs to be hosted in the available memory of the available boards.</p>
<p>The way how the web server is implemented is based on avoiding consuming server resources as much as possible and using the browser resources where possible.</p>
<blockquote>
<p>Implementing minimal javascript and CSS libraries is also part of the strategy of many web interfaces that must run smoothly on mobile devices because the network bandwidth is the most restricted resource for these use-cases as well.</p>
</blockquote>
<blockquote>
<p>Some <em><strong>“micro”</strong></em> implementations are available on the internet that just offer basic features with the focus on size.
More on this can be found in links provided below.</p>
</blockquote>
<h3>Implementing the web files</h3>
<p>There is a special project available to develop these UI components.</p>
<p>This project is using a node.js / express server to mock some of the features of the webserver of a HomeDing device and offers building a minified version of the resulting files.</p>
<p><a href="https://github.com/HomeDing/WebFiles">https://github.com/HomeDing/WebFiles</a></p>
<h2>Micro IDE</h2>
<p>The Web UI implementation from the HomeDing library supports a minimal <strong>Integrated Development Environment</strong> (IDE)
that allows modifying text based files using any browser.</p>
<p>For Details see <a href="/dev/microide.htm">Micro-IDE</a>.</p>
<h2>micro JavaScript Library</h2>
<p>The minimalist JavaScript implementation that implements templates, function and data binding and is available to the HomeDing devices.</p>
<p>The functionality offers</p>
<ul>
<li>to create new controls from given templates into the web page</li>
<li>load data given in a JSON format</li>
<li>fill data into placeholders</li>
<li>visualize data by using  bars and charts</li>
<li>capture user input that create actions on the internal elements</li>
<li>apply changes to the data model</li>
<li>send data back to the year device to update the configuration.</li>
</ul>
<p>For Details see <a href="/dev/microjavascript.htm">Micro-JavaScript</a></p>
<h2>micro JSON Parser</h2>
<p>Parsing JSON formats in the browser is supported natively and was chosen for the payload of the services and the configuration. This is not a strictly requirement for the UI to use JSON in the devices and the service but it is a common approach that works well.</p>
<p>To handle JSON based files in a C++ programming environment a parser for this file format was used. The standard library ArduinoJson was used in the beginning but after some first implementation I found out that a streaming parser fits better to the problem of the HomeDing library.</p>
<p>The micro JSON Parser is implemented in the <code>MicroJsonParser</code> class.</p>
<p>For Details see <a href="/dev/microjson.htm">Micro-JSON</a></p>
<h2>micro Hub and Store</h2>
<p>The problem the Micro Hub and Store solves is passing data from various sources over to the UI components that implement the visualization.</p>
<p>When visualizing data structures in Web Applications the Flux pattern is known to be a good approach. A full featured implementation is maintained by facebook and was adopted to many reactive web applications.</p>
<p>For the UI of the HomeDing devices the most important features of the FLUX pattern are implemented within the miro hub implementation.
It was created by extending the original OpenAjax Hub idea and implementation that the OpenAjax Alliance published around 2007 as a minimal implementation of a publish and subscribe mechanism to exchange messages between libraries.</p>
<p>At these days a dedicated store was not part of the specification and is now added into the micro hub implementation.
This allows replaying data messages to the components based on the actual data in the store.</p>
<pre><code>actions -(publish)- &gt; [data store] -&gt; [filter] -&gt; [library/component]
                          |                               |
                          +  &lt;----- (subscribe) --------- +
</code></pre>
<p>The data store here is a native javascript structured data object representing a tree of nodes and key-values.</p>
<p>All data changes are serialized and passed through a filter that only forwards relevant changes to the component.
It is focusing on a one way data flow but updates initiated by the components can be processed as well.</p>
<p>A component that wants to participate in the data flows needs to register a callback function to the</p>
<p>The filter gets all data changes</p>
<h2>More reading material</h2>
<ul>
<li><a href="https://css-tricks.com/a-minimal-javascript-setup/">https://css-tricks.com/a-minimal-javascript-setup/</a></li>
<li><a href="https://www.jotform.com/blog/11-minimal-javascript-frameworks-96416/">https://www.jotform.com/blog/11-minimal-javascript-frameworks-96416/</a></li>
<li><a href="https://github.com/fizker/minifier/blob/master/readme.md">https://github.com/fizker/minifier/blob/master/readme.md</a></li>
</ul>

        
      </main>
      <script>
        const param = {
          MENU_MIN_WIDTH: 1030
        };
        var mbObj = document.querySelector('#menuButton');
        var navObj = document.querySelector('nav');
        if (window.innerWidth > param.MENU_MIN_WIDTH) { // menu is inside the page
          navObj.classList.add('open');
          navObj.classList.add('inpage');
        }
        mbObj.addEventListener('click', function (e) {
          navObj.classList.toggle('open');
        });
        lazyLoadHTM('nav', '/toc.htm');
      </script>

      <script type="module" async>
        import mermaid from "https://unpkg.com/mermaid@10/dist/mermaid.esm.min.mjs";
        document.addEventListener('DOMContentLoaded', mermaid.initialize({startOnLoad: true}));
      </script>

    </body>
  </body>
</html>