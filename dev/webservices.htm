
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Services for IoT Devices</title>
    <script src="/pages.js"></script>
    <link content-type="text/css" href="/docstyle.css" rel="stylesheet"/>
    <script src="/story.js" type="module"></script>
    <link rel="icon" type="image/png" href="/favicon48.png" sizes="48x48">
    <meta name='description' content='Examples and documentation for the HomeDing IoT Library'>
    <meta name="google-site-verification" content="7tTF0t5uCMnyE6X31OIOQpcOf4QxWuODtyZLoVsKCEc"/>
    <meta name="msvalidate.01" content="7FC9C7BCD4002EBD89AAC2EF63D7B353"/>
  </head>
  <body scroll="0" style="padding:0;">
    <div class="u-navbar" style="margin-bottom: 0;">
      <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 48 48" id="menuButton" class="button" style="height:1.4rem">
        <path fill="white" d="M0 8h48v6H0zm0 13h48v6H0zm0 13h48v6H0z"/>
      </svg>
      <a href="/index.htm" class="button">Home</a>
      <a href="/elements/index.htm" class="button">Elements</a>
      <a href="/boards/index.htm" class="button">Boards</a>
      <a href="/recipes/index.htm" class="button">Recipes</a>
    </div>
    <nav></nav>
    <main style="padding:1rem;max-width: 800px;">
      <h1>Web Services for IoT Devices</h1>
      
        <p>To interact with the elements and some device features the integrated web server exposes some services.</p>
<p>All services use a URL that starts with <code>/api/</code>.</p>
<p>With some exceptions, these services are using the http GET schema so they can also be called using the address bar of the browser.
This is handsome for test purpose.</p>
<h3>/api/sysinfo</h3>
<p>GET <a href="http://homeding/api/sysinfo">http://homeding/api/sysinfo</a> <sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup></p>
<p>This service returns some information from the system level like the flash memory available to the file system.</p>
<p>A link to this URL is also present on the default page index.htm.</p>
<h4>Example with comments</h4>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"devicename"</span><span class="token operator">:</span> <span class="token string">"displayding"</span><span class="token punctuation">,</span> <span class="token comment">// network name of the device</span>
  <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"Jan 2 2019"</span><span class="token punctuation">,</span>       <span class="token comment">// build-date of the uploaded sketch</span>
  <span class="token property">"freeHeap"</span><span class="token operator">:</span> <span class="token string">"29224"</span><span class="token punctuation">,</span>         <span class="token comment">// actual free memory on the heap.</span>
  <span class="token property">"flashSize"</span><span class="token operator">:</span> <span class="token string">"4194304"</span><span class="token punctuation">,</span>      <span class="token comment">// flash memory sized specified at compile time</span>
  <span class="token property">"coreVersion"</span><span class="token operator">:</span> <span class="token string">"0.81"</span><span class="token punctuation">,</span>       <span class="token comment">// HomeDing Library version</span>
  <span class="token property">"coreBuild"</span><span class="token operator">:</span> <span class="token string">"standard"</span><span class="token punctuation">,</span>     <span class="token comment">// HomeDing example name (may be changed in sketch)</span>
  <span class="token property">"fsTotalBytes"</span><span class="token operator">:</span> <span class="token string">"2072576"</span><span class="token punctuation">,</span>   <span class="token comment">// size of the file system</span>
  <span class="token property">"fsUsedBytes"</span><span class="token operator">:</span> <span class="token string">"224645"</span><span class="token punctuation">,</span>     <span class="token comment">// used size of the file system</span>
  <span class="token property">"safemode"</span><span class="token operator">:</span> <span class="token string">"false"</span><span class="token punctuation">,</span>         <span class="token comment">// see [safemode](/dev/safemode.md)</span>
  <span class="token property">"upTime"</span><span class="token operator">:</span> <span class="token string">"268680"</span><span class="token punctuation">,</span>          <span class="token comment">// time since last restart</span>
  <span class="token property">"ssid"</span><span class="token operator">:</span> <span class="token string">"devnet"</span>             <span class="token comment">// actual connected network by SSID</span>
<span class="token punctuation">}</span></code></pre>
<p>This information is read only.</p>
<h3>/api/reboot</h3>
<p>GET <a href="http://homeding/api/reboot">http://homeding/api/reboot</a> <sup class="footnote-ref"><a href="#fn1" id="fnref1:1">[1:1]</a></sup></p>
<p>This service reboots the device.</p>
<h3>/api/reset<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup></h3>
<p>GET <a href="http://homeding/api/reset">http://homeding/api/reset</a> <sup class="footnote-ref"><a href="#fn1" id="fnref1:2">[1:2]</a></sup></p>
<p>This service wipes out the network configuration and then restarts the device.</p>
<h3>/api/resetall<sup class="footnote-ref"><a href="#fn2" id="fnref2:1">[2:1]</a></sup></h3>
<p>GET <a href="http://homeding/api/resetall">http://homeding/api/resetall</a> <sup class="footnote-ref"><a href="#fn1" id="fnref1:3">[1:3]</a></sup></p>
<p>This service wipes out the filesystem, the network configuration and then restarts the device.</p>
<h3>/api/elements</h3>
<p>GET <a href="http://homeding/api/elements">http://homeding/api/elements</a> <sup class="footnote-ref"><a href="#fn1" id="fnref1:4">[1:4]</a></sup></p>
<p>This REST service returns an array with all elements that are implemented in the firmware of the device.</p>
<p>Example:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">[</span>
  <span class="token string">"ssdp"</span><span class="token punctuation">,</span> <span class="token string">"ota"</span><span class="token punctuation">,</span> <span class="token string">"device"</span><span class="token punctuation">,</span> <span class="token string">"time"</span><span class="token punctuation">,</span> <span class="token string">"remote"</span><span class="token punctuation">,</span> <span class="token string">"ntptime"</span><span class="token punctuation">,</span> <span class="token string">"dstime"</span><span class="token punctuation">,</span> <span class="token string">"serialcmd"</span><span class="token punctuation">,</span> <span class="token string">"value"</span><span class="token punctuation">,</span> <span class="token string">"button"</span><span class="token punctuation">,</span>
  <span class="token string">"analog"</span><span class="token punctuation">,</span> <span class="token string">"timer"</span><span class="token punctuation">,</span> <span class="token string">"schedule"</span><span class="token punctuation">,</span> <span class="token string">"digitalout"</span><span class="token punctuation">,</span> <span class="token string">"pwmout"</span><span class="token punctuation">,</span> <span class="token string">"displaytext"</span><span class="token punctuation">,</span> <span class="token string">"displaydot"</span><span class="token punctuation">,</span> <span class="token string">"displayLCD"</span><span class="token punctuation">,</span>
  <span class="token string">"displaySSD1306"</span><span class="token punctuation">,</span> <span class="token string">"displaySH1106"</span><span class="token punctuation">,</span> <span class="token string">"dht"</span><span class="token punctuation">,</span> <span class="token string">"rfcodes"</span><span class="token punctuation">,</span> <span class="token string">"rotary"</span><span class="token punctuation">,</span> <span class="token string">"alarm"</span>
<span class="token punctuation">]</span></code></pre>
<h3>/api/scan</h3>
<p>This service is required for the network configuration page (/$setup) and returns an array with all available networks.</p>
<p>This service has to be called multiple times. The first time starts scanning and results will be available some seconds later.</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"VVBLHH09092"</span><span class="token punctuation">,</span> <span class="token property">"rssi"</span><span class="token operator">:</span> <span class="token string">"-83"</span><span class="token punctuation">,</span> <span class="token property">"open"</span><span class="token operator">:</span> <span class="token string">"0"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"devnet"</span><span class="token punctuation">,</span> <span class="token property">"rssi"</span><span class="token operator">:</span> <span class="token string">"-67"</span><span class="token punctuation">,</span> <span class="token property">"open"</span><span class="token operator">:</span> <span class="token string">"0"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"DIRECT-D9-HP OfficeJet 4650"</span><span class="token punctuation">,</span> <span class="token property">"rssi"</span><span class="token operator">:</span> <span class="token string">"-75"</span><span class="token punctuation">,</span> <span class="token property">"open"</span><span class="token operator">:</span> <span class="token string">"0"</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre>
<h3>/api/connect=…&amp;p=…** &amp;wps=… <sup class="footnote-ref"><a href="#fn2" id="fnref2:2">[2:2]</a></sup></h3>
<p>This service is required for the network configuration page (/setup.htm) and allows changing the network configuration.</p>
<h3>/api/list <sup class="footnote-ref"><a href="#fn2" id="fnref2:3">[2:3]</a></sup></h3>
<p>This service is required for the IDE page implementation (/microide.htm) and returns a list of all files on the filesystem.</p>
<h3>/api/state</h3>
<p>This service returns the state of all existing elements running in the device.</p>
<p>Example:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"device/0"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"active"</span><span class="token operator">:</span> <span class="token string">"true"</span><span class="token punctuation">,</span>
    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"DHTdevice"</span><span class="token punctuation">,</span>
    <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"IoT Dev-Device with a DHT Sensor"</span><span class="token punctuation">,</span>
    <span class="token property">"nextboot"</span><span class="token operator">:</span> <span class="token string">"90"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"ota/0"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"active"</span><span class="token operator">:</span> <span class="token string">"true"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"ssdp/0"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"active"</span><span class="token operator">:</span> <span class="token string">"true"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"remote/display-t"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"active"</span><span class="token operator">:</span> <span class="token string">"true"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"remote/display-h"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"active"</span><span class="token operator">:</span> <span class="token string">"true"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"dht/on"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"active"</span><span class="token operator">:</span> <span class="token string">"true"</span><span class="token punctuation">,</span> <span class="token property">"temperature"</span><span class="token operator">:</span> <span class="token string">"21.60"</span><span class="token punctuation">,</span> <span class="token property">"humidity"</span><span class="token operator">:</span> <span class="token string">"46.00"</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h3>/api/state/dht/on**</h3>
<p>This service returns the state of the element addressed by the more specific url. It is an excerpt of the full state above.</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"dht/on"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"active"</span><span class="token operator">:</span> <span class="token string">"true"</span><span class="token punctuation">,</span>
    <span class="token property">"temperature"</span><span class="token operator">:</span> <span class="token string">"21.60"</span><span class="token punctuation">,</span>
    <span class="token property">"humidity"</span><span class="token operator">:</span> <span class="token string">"46.00"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h3>/api/state/displaytext/t?value=21.60**</h3>
<p>This service sends an action to the element specified by the URL to set the value.</p>
<p>This is how the remote element will send actions across the network to other devices.</p>
<h3>Implementation</h3>
<p>As an implementation principle the UI presented in the browser only acts as a visual interface but doesn’t execute any functionality related to actions.
The actions will only be processed inside the device using the implemented elements completely independent from a possible open browser.</p>
<p>Restfull services using the URL for addressing and JSON for data and results have been chosen to have an acceptable size of JSON parser
and compising functions in the device while making implementation in the browser relatively easy.</p>
<p>As of now there are no advances web services features like websockets implemented.</p>
<h2>See also</h2>
<ul>
<li><a href="/dev/website.htm">Embedded Web Site for IoT Devices</a></li>
</ul>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p>replace <code>homeding</code> with the network name of your device to use this link. <a href="#fnref1" class="footnote-backref">↩︎</a> <a href="#fnref1:1" class="footnote-backref">↩︎</a> <a href="#fnref1:2" class="footnote-backref">↩︎</a> <a href="#fnref1:3" class="footnote-backref">↩︎</a> <a href="#fnref1:4" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn2" class="footnote-item"><p>this service is not available when the device runs in the save mode. See <a href="/dev/safemode.htm">Save Mode</a> for details. <a href="#fnref2" class="footnote-backref">↩︎</a> <a href="#fnref2:1" class="footnote-backref">↩︎</a> <a href="#fnref2:2" class="footnote-backref">↩︎</a> <a href="#fnref2:3" class="footnote-backref">↩︎</a></p>
</li>
</ol>
</section>

        
      </main>
      <script>
        const param = {
          MENU_MIN_WIDTH: 1030
        };
        var mbObj = document.querySelector('#menuButton');
        var navObj = document.querySelector('nav');
        if (window.innerWidth > param.MENU_MIN_WIDTH) { // menu is inside the page
          navObj.classList.add('open');
          navObj.classList.add('inpage');
        }
        mbObj.addEventListener('click', function (e) {
          navObj.classList.toggle('open');
        });
        lazyLoadHTM('nav', '/toc.htm');
      </script>

      <script type="module" async>
        import mermaid from "https://unpkg.com/mermaid@10/dist/mermaid.esm.min.mjs";
        document.addEventListener('DOMContentLoaded', mermaid.initialize({startOnLoad: true}));
      </script>

    </body>
  </body>
</html>